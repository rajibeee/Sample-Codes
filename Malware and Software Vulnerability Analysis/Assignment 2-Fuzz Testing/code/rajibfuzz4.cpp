
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include <sys/wait.h>


int main(void)
{ 
		char jpeg_data[100000];
		int crash_counter=0;
		int input_file_size;
		int i;
		FILE *fileInput, *fileOutput;
	   int status; 
	   int return_Val ;
	   int return_Val_Code;
	   char F_name[20];
	   char cmd_buffer[200];
	   int rand_1 ;
	   int rand_2 ;
	   
		for (i=1;i<=1000;i++)
		{
				fileInput=fopen("./cross.jpg","rb");
				fileOutput=fopen("./cross-1.jpg", "wb");
				fseek(fileInput,0,SEEK_END);
				input_file_size=ftell(fileInput);
				fseek(fileInput,0,SEEK_SET);
				fread (jpeg_data,1,input_file_size,fileInput);
				int rand_1 = rand()%808;  
				jpeg_data[rand_1] = 'N' ; // change the values of jpeg.
				fwrite (jpeg_data,1,input_file_size,fileOutput);
				fclose(fileInput);
				fclose(fileOutput);
				sprintf(cmd_buffer,"./jpg2bmp cross-1.jpg temp.bmp");
				return_Val = system(cmd_buffer);
			    wait(&status); 
			    return_Val_Code = WEXITSTATUS(return_Val); 
				if ( return_Val_Code == 128+11 || return_Val_Code ==128+6) 
					 {
						crash_counter ++;
						sprintf(F_name,"./crashed-%d.jpg",crash_counter); 
						 //printf("%s\n",name);
						puts(F_name) ;
						fileOutput=fopen(F_name, "wb");
						fwrite (jpeg_data,1,input_file_size,fileOutput);
						fclose(fileOutput);
					 }
		}
		return 0; 
}




